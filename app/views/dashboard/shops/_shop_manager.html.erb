<% @shop_mn.each do |shop_mn| %>
  <% if shop_mn.role == "manager" %>
    <div class="col-sm-4 row block-shop-feed-item2 padding-l div-item">
      <div class="col-md-4 shop_image">
        <div class="row shop_width">
          <%= link_to domain_dashboard_shop_path(@domain, shop_mn.shop) do %>
            <%= image_tag shop_mn.shop.avatar.url, class: "image-shop-show" %>
          <% end %>
        </div>
      </div>
      <div class="col-md-8 shop_text">
        <div class="row shop-manager-margin-left-right ">
          <div>
            <h3 class="shop-name-small">
              <%= link_to shop_mn.shop.name, domain_dashboard_shop_path(@domain, shop_mn.shop) %>
            </h3><%= render "shared/shop_status_label", shop: shop_mn.shop %>
          </div>

          <div class="description-margin-bot checkbox_<%= shop_mn.shop.id %> set_inline">
            <%= render "dashboard/shops/shop_label_status", shop: shop_mn.shop %>
          </div>
          <div class="onoffswitch">
            <% if shop_mn.shop.status_on_off == Settings.shop_status_off %>
              <input type="checkbox" name="<%= "checkbox_#{shop_mn.shop.id}" %>"
                class="onoffswitch-checkbox" id="<%= "checkbox_#{shop_mn.shop.id}" %>"
                value="<%= shop_mn.shop.id %>" data-remote="true">
            <% else %>
              <input type="checkbox" name="<%= "checkbox_#{shop_mn.shop.id}" %>"
                class="onoffswitch-checkbox" id="<%= "checkbox_#{shop_mn.shop.id}" %>"
                value="<%= shop_mn.shop.id %>" data-remote="true" checked="checked">
            <% end %>
            <label class="onoffswitch-label" for="<%= "checkbox_#{shop_mn.shop.id}" %>">
              <span class="onoffswitch-inner"></span>
              <span class="onoffswitch-switch"></span>
            </label>
          </div>
          <div class="description quote", title="<%= shop_mn.shop.description %>"><p>
            <%= truncate(shop_mn.shop.description, length: Settings.max_description) %></p>
          </div>
        </div>
      </div>
      <div class="row margin-top-50">
        <div class="col-lg-12">
          <table id="domain-table"
          class="table table-striped table-hovertable-bordered text-center">
            <thead>
            <tr>
              <th><%= t "request_shop.domain_name" %></th>
              <th><%= t "members" %></th>
              <th><%= t "shop" %></th>
              <th><%= t "products" %></th>
              <th><%= t "request_shop.status" %></th>
              <th class="last">
                <%= t "request_shop.request_to_domain" %>
              </th>
            </tr>
            </thead>
            <tbody>
              <% @current_user.domains.each do |domain|  %>
                <tr>
                  <td title="<%= domain.name %>"><%= truncate(domain.name,
                    length: Settings.max_domain_name) %></td>
                  <td><%= domain.users.size %></td>
                  <td><%= domain.shop_domains.approved.size %></td>
                  <td><%= domain.products.size %></td>
                  <td>
                    <% if domain.shops.include? shop_mn.shop %>
                      <%= status_request_shop shop_mn.shop.request_status domain %>
                    <% end %>
                  </td>
                  <td>
                    <% shop_domain = ShopDomain.find_by shop_id: shop_mn.shop.id,
                      domain_id: domain.id %>
                    <% if !domain.shops.include? shop_mn.shop %>
                      <% if domain.owner? current_user.id %>
                        <%= link_to t("request_shop.request_to_domain"),
                          shop_domains_path(shop_id: shop_mn.shop.id,
                          domain_id: domain.id, status: :approved), method: :post,
                          class: "btn btn-info refresh" %>
                      <% else %>
                        <%= link_to t("request_shop.request_to_domain"),
                          shop_domains_path(shop_id: shop_mn.shop.id,
                          domain_id: domain.id, status: :pending), method: :post,
                          class: "btn btn-info refresh"%>
                      <% end %>
                    <% else %>
                      <% if shop_mn.shop.request_status(domain).rejected? %>
                        <%= link_to t("request_shop.request_to_domain"),
                        shop_domain_path(shop_domain, status: :pending),
                        method: :put, class: "btn btn-info refresh"%>
                      <% else %>
                        <%= link_to t("request_shop.cancel"),
                          shop_domain_path(shop_domain,
                          domain_id: domain.id, shop_id: shop_mn.shop.id), method: :delete,
                          data: {confirm: t("common.delete_confirm")},
                          class: "btn btn-danger" %>
                      <% end %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
